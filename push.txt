param(
  [string]$Message = "deploy",
  [string]$CustomDomain = "hprtest.online"
)

$ErrorActionPreference = "Stop"

cmd /c build.bat

git fetch origin
git worktree remove ..\gh-pages 2>$null
git worktree add -B gh-pages ..\gh-pages origin/gh-pages

robocopy site ..\gh-pages /MIR > $null

Set-Content ..\gh-pages\CNAME -NoNewline -Value $CustomDomain
if (!(Test-Path ..\gh-pages\.nojekyll)) { New-Item -ItemType File ..\gh-pages\.nojekyll | Out-Null }

Push-Location ..\gh-pages
git add -A
git commit -m $Message 2>$null
git push origin gh-pages
Pop-Location
